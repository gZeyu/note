# 用户关系分析
## 四种用户关系状态
- 关注
- 粉丝
- 互关
- 无关系

这四种状态在查询用户粉丝、关注和互关等列表、浏览用户主页的时候会用到
## 功能需求
### 基础需求
- 查询用户的关注列表
- 查询用户的粉丝列表
- 查询用户的互关列表
- 查询两个用户关系状态
- 推送关注用户动态
### 拓展需求
- 两个用户的共同关注列表
- 两个用户的共同粉丝列表
- 用户a的关注列表里都有谁关注了用户b

## 方案1
### 关系模式
每个用户可以关注任意多个其他用户，同时也可以被任意多个其他用户关注。这是用户实体集内部各个实体的多对多的联系，所以只需两个表：`blog_user`和`bolg_follower`
```
blog_user(id, username, ..., gmt_create, gmt_modified)
```
```
blog_follower(id, follower, followed, gmt_create, gmt_modified)
```
### 索引
在`blog_follower`表中建一个联合索引`(follower, followed)`和一个单列索引`(followed)`。查询语句执行时会依照最左前缀匹配原则，故这里省略`(follower)`索引的创建。
```sql
create index idx_follower_followed on blog_follower(follower, followed) online
```
```sql
create index idx_followed on blog_follower(followed) online
```

### 查询用户的关注列表
```sql
select followed from blog_follower WHERE follower = user_id
```
### 查询用户的粉丝列表
```sql
select follower from blog_follower WHERE followed = user_id
```
### 查询用户的互关列表
```sql
select t1.follower from (select follower from blog_follower WHERE followed = user_id) as t1 inner join blog_follower as t2 on t1.followed = t2.follower
```
### 查询两个用户关系状态
```sql
select sum(follower = user_a_id and followed = user_b_id)+sum(follower = user_b_id and followed = user_a_id) from blog_follower 
```
### 两个用户的共同关注列表
```sql

```
## 参考
1. [用MySQL实现微博关注关系的方案分析](https://my.oschina.net/yonghan/blog/475588)
2. [微博关注我、我关注你数据库该怎么设计](https://blog.csdn.net/u010098331/article/details/51445904)
<!--stackedit_data:
eyJoaXN0b3J5IjpbMTgzMzU0NDY3MSwtMTkxMDY4MzI1NSwyMj
k1MTg1NTgsNzI5MjkyMzQwLDE4MzA3OTEzMCwtMTM2OTQ2NjMy
MiwxMjU0ODg4NDYxLDE5MTEzMDcwMjcsMjEzMzU0NzE3Myw1Mz
E5MzA1MzMsMjQwNTgzODI4LDQ5NzYxNTY1OCwtMTk4MjIxNzE2
MiwtMjA4OTY4MTYzMyw3NDk1OTQ0MCwxNjIxMDk2NjY5LC0xNz
A4MTMyOTQzLDg2NDA0MTQzOSwxNzQ2NzAzNjQwLC0xNTI3Mzk1
NjM3XX0=
-->