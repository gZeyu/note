### 用户管理
#### 登录和鉴权
- 商店和商家用户是两个不同的实体，商店的商家用户是可更换的。商店和商家用户应该分两张表单独存，再关联起来
- 从个人用户、商家用户和管理员中抽取通用的用户表，做登录和鉴权
- 采用`RBAC`进行权限管理
	- 由于会员、积分、黑名单等原因，不同个人用户的权限会有区别
	- 由于策略、黑名单等原因，不同商家用户的权限会有区别
```
o_user(id, username, nickname, phone_number, password, salt, avatar, points, status)
o_role(id, role_name)
o_permission(id, permission_name, method, url, description)
o_user_role(id, user_id, role_id)
o_role_permission(id, role_id, permission_id)
```
> TODO ： URL直接放权限表里，还是新建资源表存，然后在关联资源表和权限表
#### 收货地址
- 一个用户可能有多个收货地址
```
o_user_address(id, user_id, address)
```
#### 店铺收藏
- 一个用户可以收藏多个店铺
```
o_favorite_shop(id, user_id, shop_id)
```
#### 红包管理
- 红包类型有多种，一个用户可以有多个红包
```
o_coupon(id, satisfy, minus)
o_user_coupon(id, user_id, coupon_id)
```
### 商店管理
#### 商店表
```
o_shop(id, shop_name, manager_id, salt, avatar, info, announcement, score, shipping_fee)
```
#### 外卖菜单
- 菜单目录和产品是多对多的关系，比如炒饭可以同时放在“进店推荐”和主食这两个分类
```
o_product(id, name, image, price, like, sales)
o_shop_menu(id, menu_item_id)
o_shop_menu_product(id, menu_item_id, product_id)
```
#### 满减优惠和折扣优惠
- 商家用户可以选择设置单个产品的折扣
- 满减优惠和折扣优惠不能同享
```
o_full_reduction_offer(id, shop_id, satisfy, minus)
o_discount(id, product_id, discount)
```
### 订单管理

#### 订单表
- 一个订单对应多个商品
- 在订单提交后可能会变动的信息要在提交订单时固定到订单记录中，如商品价格、商品折扣以及用户相关信息
```
o_order(id, order_serial_number, user_id, shop_id, orderer_name, orderer_phone_number, orderer_address，full_reduction_offer, coupon, total_price, score, status)
o_order_product(id, order_id, product_id, product_price, discount)
```
#### 订单评论
- 订单结束后，用户可以评价本次服务
- 商店用户可回复此评论
- 不可追评
```
o_order_comment(id, order_id, user_id, parent_id, content, score, like)
```
### 统计与分析
> 上述关系模式皆省略`create_by, modified_by, gmt_create, gmt_modified`属性。

<!--stackedit_data:
eyJoaXN0b3J5IjpbMTUwODQ5MjQ1NSwtMTY3Njk4MDg1NSwtMT
UxNDgwNTYyMywtMTIyMzAwOTY1MiwxMTA3NjUzMDkzLC0yMDcx
ODczNzQ2LDkxODkxMzEzNSwtMTE3NjM1MTEyNSwtOTY0NTAwOT
g0LDE1NDM5NDcyMTUsLTEwOTM5NTEzODEsMTcwMzA2OTI1Mywx
NTg1Mzg4NzA4LDM2MzIwODQ4LC0xNTEzNzU3ODU0LC0xMDE5OD
AzMzQ1LDEyNjA2MjUyOTAsLTEwNjkzNjY5ODcsLTE1NDU1Njgw
MjMsMTY2MjA3OTI5MV19
-->